<div class="layout-header">
  <h2 class="layout-header__title mt-0 mb-0 mr-25 ml-25">
    {{ 'settings-network.Network' | translate }}
  </h2>
  <div class="layout-header__tabs">
    <nav mat-tab-nav-bar mat-align-tabs="center">
      <a
        *ngFor="let tab of tabs"
        mat-tab-link
        [active]="tab === selectedTab"
        (click)="onSelectTab(tab)"
        >{{ 'settings-network.Tabs.' + tab | translate }}</a
      >
    </nav>
  </div>
</div>
<mat-divider></mat-divider>
<div class="pl-25 pr-25">
  <div class="pb-25" [ngSwitch]="selectedTab">
    <ng-container *ngSwitchCase="NetworkType.ETHERNET_X1">
      <h3>{{ 'settings-network.AdapterSettings' | translate }}</h3>
    </ng-container>
    <ng-container *ngSwitchCase="NetworkType.ETHERNET_X2">
      <h3>{{ 'settings-network.AdapterSettings' | translate }}</h3>
    </ng-container>
    <ng-container *ngSwitchCase="NetworkType.PROXY">
      <h3>{{ 'settings-network.ProxySettings' | translate }}</h3>
    </ng-container>
    <ng-container *ngSwitchCase="NetworkType.TIME">
      <h3>{{ 'settings-network.TimeSettings' | translate }}</h3>
    </ng-container>
    <mat-divider></mat-divider>
  </div>

  <div class="row" [ngSwitch]="selectedTab">
    <div class="col-12 col-md-7 col-lg-5">
      <ng-container *ngSwitchCase="NetworkType.ETHERNET_X1">
        <form #mainForm="ngForm">
          <div class="d-flex align-items-center justify-content-between">
            <div class="mr-30">
              {{ 'settings-network.AssignIPManually' | translate }}
            </div>
            <mat-slide-toggle
              class="ml-20"
              name="notToUseDhcp"
              [ngModel]="!config[NetworkType.ETHERNET_X1].useDhcp"
              (ngModelChange)="
                config[NetworkType.ETHERNET_X1].useDhcp = !$event
              "
            ></mat-slide-toggle>
          </div>

          <div class="mt-20 d-flex align-items-center justify-content-between">
            <div class="mt-0 mr-25 text-nowrap">
              {{ 'settings-network.IPAddress' | translate }}
            </div>
            <div>
              <mat-form-field>
                <input
                  matInput
                  name="ipAddr"
                  #ipAddr="ngModel"
                  [(ngModel)]="config[NetworkType.ETHERNET_X1].ipAddr"
                  [pattern]="ipRegex"
                  [disabled]="!!config[NetworkType.ETHERNET_X1].useDhcp"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="mt-20 d-flex align-items-center justify-content-between">
            <div class="mt-0 mr-25 text-nowrap">
              {{ 'settings-network.Netmask' | translate }}
            </div>
            <div>
              <mat-form-field>
                <input
                  matInput
                  name="netmask"
                  #netmask="ngModel"
                  [(ngModel)]="config[NetworkType.ETHERNET_X1].netmask"
                  [pattern]="ipRegex"
                  [disabled]="!!config[NetworkType.ETHERNET_X1].useDhcp"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="mt-20 d-flex align-items-center justify-content-between">
            <div class="mt-0 mr-25 text-nowrap">
              {{ 'settings-network.DefaultGateway' | translate }}
            </div>
            <div>
              <mat-form-field>
                <input
                  matInput
                  name="defaultGateway"
                  #defaultGateway="ngModel"
                  [(ngModel)]="config[NetworkType.ETHERNET_X1].defaultGateway"
                  [pattern]="ipRegex"
                  [disabled]="!!config[NetworkType.ETHERNET_X1].useDhcp"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="mt-20 d-flex align-items-center justify-content-between">
            <div class="mt-0 mr-25 text-nowrap">
              {{ 'settings-network.DNSServer' | translate }}
            </div>
            <div>
              <mat-form-field>
                <input
                  matInput
                  name="dnsServer"
                  #dnsServer="ngModel"
                  [(ngModel)]="config[NetworkType.ETHERNET_X1].dnsServer"
                  [pattern]="ipRegex"
                  [disabled]="!!config[NetworkType.ETHERNET_X1].useDhcp"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="d-flex justify-content-end mt-25">
            <button
              mat-raised-button
              [disabled]="mainForm.invalid || !mainForm.dirty"
              (click)="saveChanges(mainForm, NetworkType.ETHERNET_X1)"
            >
              {{ 'settings-network.Apply' | translate }}
            </button>
          </div>
        </form>
      </ng-container>

      <ng-container *ngSwitchCase="NetworkType.ETHERNET_X2">
        <form #mainForm="ngForm">
          <div class="d-flex align-items-center justify-content-between">
            <div class="mr-30">
              {{ 'settings-network.AssignIPManually' | translate }}
            </div>
            <mat-slide-toggle
              class="ml-20"
              name="notToUseDhcp"
              [ngModel]="!config[NetworkType.ETHERNET_X2].useDhcp"
              (ngModelChange)="
                config[NetworkType.ETHERNET_X2].useDhcp = !$event
              "
            ></mat-slide-toggle>
          </div>

          <div class="mt-20 d-flex align-items-center justify-content-between">
            <div class="mt-0 mr-25 text-nowrap">
              {{ 'settings-network.IPAddress' | translate }}
            </div>
            <div>
              <mat-form-field>
                <input
                  matInput
                  name="ipAddr"
                  #netmask="ngModel"
                  [(ngModel)]="config[NetworkType.ETHERNET_X2].ipAddr"
                  [pattern]="ipRegex"
                  [disabled]="!!config[NetworkType.ETHERNET_X2].useDhcp"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="mt-20 d-flex align-items-center justify-content-between">
            <div class="mt-0 mr-25 text-nowrap">
              {{ 'settings-network.Netmask' | translate }}
            </div>
            <div>
              <mat-form-field>
                <input
                  matInput
                  name="netmask"
                  #netmask="ngModel"
                  [(ngModel)]="config[NetworkType.ETHERNET_X2].netmask"
                  [pattern]="ipRegex"
                  [disabled]="!!config[NetworkType.ETHERNET_X2].useDhcp"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="mt-20 d-flex align-items-center justify-content-between">
            <div class="mt-0 mr-25 text-nowrap">
              {{ 'settings-network.DefaultGateway' | translate }}
            </div>
            <div>
              <mat-form-field>
                <input
                  matInput
                  name="defaultGateway"
                  #defaultGateway="ngModel"
                  [(ngModel)]="config[NetworkType.ETHERNET_X2].defaultGateway"
                  [pattern]="ipRegex"
                  [disabled]="!!config[NetworkType.ETHERNET_X2].useDhcp"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="mt-20 d-flex align-items-center justify-content-between">
            <div class="mt-0 mr-25 text-nowrap">
              {{ 'settings-network.DNSServer' | translate }}
            </div>
            <div>
              <mat-form-field>
                <input
                  matInput
                  name="dnsServer"
                  #dnsServer="ngModel"
                  [(ngModel)]="config[NetworkType.ETHERNET_X2].dnsServer"
                  [pattern]="ipRegex"
                  [disabled]="!!config[NetworkType.ETHERNET_X2].useDhcp"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="d-flex justify-content-end mt-25">
            <button
              mat-raised-button
              [disabled]="mainForm.invalid || !mainForm.dirty"
              (click)="saveChanges(mainForm, NetworkType.ETHERNET_X2)"
            >
              {{ 'settings-network.Apply' | translate }}
            </button>
          </div>
        </form>
      </ng-container>
      <ng-container *ngSwitchCase="NetworkType.PROXY">
        <form #mainForm="ngForm">
          <div class="d-flex align-items-center justify-content-between mb-10">
            <div class="mr-30">
              {{ 'settings-network.UseProxy' | translate }}
            </div>
            <mat-slide-toggle
              class="ml-20"
              name="useProxy"
              [(ngModel)]="config[NetworkType.PROXY].useProxy"
            ></mat-slide-toggle>
          </div>

          <div class="d-flex align-items-center justify-content-between">
            <div class="mr-30">
              {{ 'settings-network.ProxyType' | translate }}
            </div>

            <div>
              <mat-form-field>
                <mat-select
                  name="type"
                  [(ngModel)]="config[NetworkType.PROXY].type"
                  [disabled]="!config[NetworkType.PROXY].useProxy"
                >
                  <mat-option [value]="ProxyType.Socks5">
                    {{ ProxyType.Socks5 }}
                  </mat-option>
                  <mat-option [value]="ProxyType.Http">
                    {{ ProxyType.Http }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="d-flex align-items-center justify-content-between">
            <div class="mr-30">
              {{ 'settings-network.Host' | translate }}
            </div>

            <div>
              <mat-form-field>
                <input
                  matInput
                  name="ipAddr"
                  #ipAddr="ngModel"
                  [(ngModel)]="config[NetworkType.PROXY].ipAddr"
                  [pattern]="hostRegex"
                  [required]="!!config[NetworkType.PROXY].useProxy"
                  [disabled]="!config[NetworkType.PROXY].useProxy"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="d-flex align-items-center justify-content-between">
            <div class="mr-30">
              {{ 'settings-network.Port' | translate }}
            </div>

            <div>
              <mat-form-field>
                <input
                  matInput
                  name="port"
                  type="text"
                  min="1"
                  max="65535"
                  [(ngModel)]="config[NetworkType.PROXY].port"
                  #port="ngModel"
                  [pattern]="portRegex"
                  [required]="!!config[NetworkType.PROXY].useProxy"
                  [disabled]="!config[NetworkType.PROXY].useProxy"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="d-flex align-items-center justify-content-between">
            <div class="mr-30">
              {{ 'settings-network.Username' | translate }}
            </div>

            <div>
              <mat-form-field>
                <input
                  matInput
                  name="username"
                  [(ngModel)]="config[NetworkType.PROXY].username"
                  [disabled]="!config[NetworkType.PROXY].useProxy"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="d-flex align-items-center justify-content-between">
            <div class="mr-30">
              {{ 'settings-network.Password' | translate }}
            </div>

            <div>
              <mat-form-field>
                <input
                  matInput
                  name="password"
                  type="password"
                  [(ngModel)]="config[NetworkType.PROXY].password"
                  [disabled]="!config[NetworkType.PROXY].useProxy"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="d-flex justify-content-end mt-25">
            <button
              mat-raised-button
              [disabled]="mainForm.invalid || !mainForm.dirty"
              (click)="saveChanges(mainForm, NetworkType.PROXY)"
            >
              {{ 'settings-network.Apply' | translate }}
            </button>
          </div>
        </form>
      </ng-container>

      <ng-container *ngSwitchCase="NetworkType.TIME">
        <form #mainForm="ngForm">
          <div class="d-flex align-items-center justify-content-between mb-10">
            <div class="mr-30">
              {{ 'settings-network.UseNTPServer' | translate }}
            </div>
            <mat-slide-toggle
              class="ml-20"
              name="useNtp"
              [(ngModel)]="config[NetworkType.TIME].useNtp"
            ></mat-slide-toggle>
          </div>

          <div
            *ngIf="config[NetworkType.TIME].useNtp"
            class="d-flex align-items-center justify-content-between"
          >
            <div class="mr-30">
              {{ 'settings-network.SetNTPServer' | translate }}
            </div>

            <div>
              <mat-form-field 
                *ngIf="config[NetworkType.TIME].reachable === false" class="nptUnreachable">
                <input
                  matInput
                  name="ntpHost"
                  #ipAddr="ngModel"
                  [(ngModel)]="config[NetworkType.TIME].ntpHost"
                  [pattern]="hostRegex"
                  matTooltip="{{ 'settings-network.nptUnreachableLong' | translate }}"
                  matTooltipPosition="above"
                  [required]="!!config[NetworkType.TIME].useNtp"/>
                  <mat-hint>{{ 'settings-network.nptUnreachable' | translate }}</mat-hint>
              </mat-form-field>
              <mat-form-field 
              *ngIf="config[NetworkType.TIME].reachable">
              <input
                matInput
                name="ntpHost"
                #ipAddr="ngModel"
                [(ngModel)]="config[NetworkType.TIME].ntpHost"
                [pattern]="hostRegex"
                [required]="!!config[NetworkType.TIME].useNtp"
              />
              </mat-form-field>
            </div>
          </div>

          <ng-container *ngIf="!config[NetworkType.TIME].useNtp">
            <div class="d-flex align-items-center justify-content-between">
              <div class="mr-30">
                {{ 'settings-network.SetCurrentTime' | translate }}
              </div>

              <div>
                <mat-form-field>
                  <input
                    name="currentTime"
                    matInput
                    [ngxMatDatetimePicker]="picker"
                    [(ngModel)]="config[NetworkType.TIME].currentTime"
                    required
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="$any(picker)"
                  ></mat-datepicker-toggle>
                  <ngx-mat-datetime-picker #picker></ngx-mat-datetime-picker>
                </mat-form-field>
              </div>
            </div>
            <div class="d-flex align-items-center justify-content-between">
              <div class="mr-30">
                {{ 'settings-network.ChooseTimeZone' | translate }}
              </div>

              <div>
                <mat-form-field>
                  <mat-select
                      name="timezone"
                      [(ngModel)]="config[NetworkType.TIME].timezone"
                      required
                    >
                    <mat-option>
                      <ngx-mat-select-search
                        placeholderLabel="Search..."
                        noEntriesFoundLabel="No results found"
                        [(ngModel)]="timezoneOptionKeyphrase"
                        [ngModelOptions]="{standalone: true}"
                      ></ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let opt of timezoneOptionsSearchResults" [value]="opt">
                      {{ opt }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </ng-container>

          <div class="d-flex justify-content-end mt-25">
            <button
              mat-raised-button
              [disabled]="mainForm.invalid || !mainForm.dirty"
              (click)="saveChanges(mainForm, NetworkType.TIME)"
            >
              {{ 'settings-network.Apply' | translate }}
            </button>
          </div>
        </form>
      </ng-container>
    </div>
  </div>
</div>
